<script>
  document.addEventListener('DOMContentLoaded', () => {
    const settings = JSON.parse(localStorage.getItem('adminSettings')) || {};
    const blockedSlots = JSON.parse(localStorage.getItem('blockedSlots')) || {};

    if (settings.businessName) document.getElementById('business-name').textContent = settings.businessName;
    if (settings.primaryColor) document.documentElement.style.setProperty('--primary-color', settings.primaryColor);
    if (settings.fontChoice) document.body.style.fontFamily = settings.fontChoice;
    if (settings.servicePricing) {
      const prices = settings.servicePricing.split('\n');
      prices.forEach(priceLine => {
        const [service, price] = priceLine.split(':');
        if (service && price) {
          const serviceId = service.trim().toLowerCase().replace(' ', '-') + '-price';
          const element = document.getElementById(serviceId);
          if (element) {
            element.textContent = price.trim();
          }
        }
      });
    }
    if (settings.sectionVisibility) {
      document.getElementById('makeup-service').style.display = settings.sectionVisibility.makeup ? 'block' : 'none';
      document.getElementById('hair-service').style.display = settings.sectionVisibility.hair ? 'block' : 'none';
      document.getElementById('lash-service').style.display = settings.sectionVisibility.lash ? 'block' : 'none';
    }

    // Automatically fill in the selected date and time
    const dateInput = document.getElementById('date');
    const timeSlotSelect = document.getElementById('time-slot');
    const calendarDiv = document.getElementById('calendar');

    calendarDiv.addEventListener('click', () => {
      const selectedDate = new Date().toISOString().split('T')[0];
      dateInput.value = selectedDate;
      updateTimeSlots(selectedDate);
    });

    function updateTimeSlots(date) {
      let availableSlots = [
        "09:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00"
      ];
      const bookedSlots = blockedSlots[date] || [];
      timeSlotSelect.innerHTML = availableSlots
        .filter(slot => !bookedSlots.includes(slot))
        .map(slot => `<option value="${slot}">${slot}</option>`) // Show only available slots
        .join('');
    }

    timeSlotSelect.addEventListener('change', () => {
      const selectedTime = timeSlotSelect.value;
      if (selectedTime) {
        // Temporarily block the slot for 45 seconds
        const selectedDate = dateInput.value;
        if (!blockedSlots[selectedDate]) blockedSlots[selectedDate] = [];
        blockedSlots[selectedDate].push(selectedTime);
        localStorage.setItem('blockedSlots', JSON.stringify(blockedSlots));
        updateTimeSlots(selectedDate);
        
        setTimeout(() => {
          // Unblock if the appointment wasn't confirmed
          const index = blockedSlots[selectedDate].indexOf(selectedTime);
          if (index > -1) {
            blockedSlots[selectedDate].splice(index, 1);
            localStorage.setItem('blockedSlots', JSON.stringify(blockedSlots));
            updateTimeSlots(selectedDate);
          }
        }, 45000);
      }
    });

    // Confirm booking and permanently block the slot
    document.getElementById('booking-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const selectedDate = dateInput.value;
      const selectedTime = timeSlotSelect.value;
      if (!blockedSlots[selectedDate]) blockedSlots[selectedDate] = [];
      blockedSlots[selectedDate].push(selectedTime);
      localStorage.setItem('blockedSlots', JSON.stringify(blockedSlots));
      updateTimeSlots(selectedDate);
      document.getElementById('confirmation-message').style.display = 'block';
      e.target.reset();
    });
  });
</script>

<style>
  /* Responsive Design for Mobile Users */
  @media (max-width: 768px) {
    body {
      font-size: 16px;
      padding: 10px;
    }
    nav ul {
      flex-direction: column;
      align-items: center;
      gap: 1rem;
    }
    .service-list {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }
    .service-item {
      width: 100%;
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    input, select, textarea {
      width: 100%;
      padding: 0.75rem;
      font-size: 1rem;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      padding: 1rem;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
    }
    button:hover {
      background-color: darken(var(--primary-color), 10%);
    }
  }
</style>
