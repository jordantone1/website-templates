<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Setup - Scheduling Template</title>
  <script>
    // Function to handle Web App URL submission
    function linkGoogleSheet() {
      const webAppURL = document.getElementById('sheet-url').value;
      if (validateWebAppURL(webAppURL)) {
        // Insert the provided Web App URL into the booking system dynamically
        updateClientSite(webAppURL);
        alert('Google Apps Script Web App successfully linked!');
      } else {
        alert('Please enter a valid Google Apps Script Web App URL.');
      }
    }

    // Validate if the URL is a valid Google Apps Script Web App URL
    function validateWebAppURL(url) {
      const regex = /^https:\/\/script\.google\.com\/macros\/s\/[-\w]+\/exec$/;
      return regex.test(url);
    }

    // Function to update the client-facing site dynamically
    function updateClientSite(webAppURL) {
      // This creates a script element that integrates the booking system with the provided Web App URL
      const script = document.createElement('script');
      script.type = 'text/javascript';
      script.textContent = `
        const googleWebAppURL = '${webAppURL}';
        function fetchBookings() {
          fetch(googleWebAppURL, {
            method: 'GET'
          })
            .then(response => response.json())
            .then(data => {
              console.log('Booking Data:', data);
              // Logic to block off booked slots can be added here
            })
            .catch(error => console.error('Error fetching data:', error));
        }
        fetchBookings();
      `;
      document.body.appendChild(script);
    }
  </script>
</head>
<body>
  <h1>Admin Setup</h1>
  <p>Paste your Google Apps Script Web App link below to link your booking system:</p>
  <input type="text" id="sheet-url" placeholder="Paste your Google Apps Script Web App URL here" style="width: 300px;">
  <button onclick="linkGoogleSheet()">Confirm & Link</button>
</body>
</html>
